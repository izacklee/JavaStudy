文档管理系统需求分析
#### 1.用户
#### 2.文件管理
   （1）目录
   （2）文件
        1）Excel
        2）PPT
        3）Word
   （3）菜单
        1）文件分类
        2）时间排序
        3）删除状态
   （4）浏览
        4.1）分类浏览
        4.2）分页浏览    
   （5）在线编辑    
   （6）容量管理
        1）容量控制
        2）升级容量思路
            2.1）充值
            2.2）后台管理
            2.3）结合管理(既可以充值也可以后台管理)
   （7）文件操作
        1）上传：单个上传
        2）下载：批量下载
        3）移动：批量移动
        4）重命名：单个重命名
        5）删除：批量删除
        6）新建目录：单个新建   
 #### 3.需求分析
   （1）性能体验
        1）上传和下载都需要通过流来完成传递
        2）流的性能瓶颈在于需要大量占用通讯通道
        3）负载均衡（解决大量占用通讯通道问题）
        4）在负载均衡环境中，如何完成开发工作
   （2）用户
        1）注册：正常注册
        2）登录：登录后，用户token的使用
   （3）文件
        1）文件存在HDFS当中：
            1.1）需不需要在hdfs当中建立多级路径：需要
            1.2）HDFS和数据库当中的文件，记录之间的联系（用户标识+路径+文件名）
            1.3）当HDFS当中的文件操作异常，如何处理？（以HDFS为准）
        2）文件要分类过滤 
            2.1）怎么来进行过滤和分类，不可以在HDFS当中使用递归来查找（太慢了）
            2.2）在数据库当中保存文件名，类型，路径，容量，时间
            2.3）路径（不是文件）不需要入库
        3）文件的操作需要同时完成HDFS和数据库的整体操作
        4）历史记录
            4.1）单独维护一张历史记录表，专门用于记录文档的操作时间  
            4.2）什么样的情况下才算是历史记录？任何对文件的操作都算历史记录
            4.3）同一个文件更新历史记录（做增量表（就是不能删不能改，只能加），为了后期做数据分析用）
            4.4）加更新状态字段（0历史/1新建），插入数据前，获取前一次更新状态为1的记录，把他改为0，
            然后再新建一条状态为1，查询只需要过滤条件为1的所有记录就行。
        5）垃圾箱
            5.1）文件的删除状态：0可用/1垃圾箱（数据库逻辑删除，把删除的数据持久化到缓存当中）
                /2彻底删除（数据库逻辑删除或物理删除，同时还要删除HDFS）
            5.2）我的文档/最近，都需要把垃圾箱的数据过滤掉     
            5.3）HDFS当中没有保存删除状态
            5.4）展示HDFS的内容，要比对数据库当中的当前文件的状态
            5.5）不应当到数据库里去比对（数据库文件基数大太慢了，比如有1000条，那就要比1000次），
                把垃圾箱当中的数据放入到缓存当中，从缓存去比对
            5.6）还原
                5.6.1）改回状态
                5.6.2）删除缓存当中的数据        
        6）容量
            6.1）最大值：默认/要有扩容到期时间/扩容的大小
            6.2）当前值：包含回收站和当前所有文件的所有容量和，当当前容量大于等于最大值，则不允许上传；
                当前容量+上传文件容量，大于最大值，不允许上传
            6.3）统计
                6.3.1）数据库当中文件各有文件容量值
                6.3.2）HDFS当中也可以找到所有文件容量  
            6.4）单独维护一张容量表：记录某个人当前使用的容量   
        7）文件操作
            7.1）新增上传重复
            7.2）修改重复
            7.3）删除后还原重复   
#### 4.数据建模
   （1）用户表User
        1）数据引擎：MyISAM（因不存在并发和事务）
        2）字段：
            2.1）Id:int auto pk
            2.2）Username:varchar(20)
            2.3）Password:varchar(100)
            2.4）Realname:varchar(100)
            2.5）APPID:varchar(100) 
                (APPID+Token是通讯的标识，一个是私钥，一个是公钥)
            2.6）Create_time:datetime
            2.7）Update_time:datetime
   （2）文件File_cloud
        1）数据引擎：InnoDB（存在大量的批量处理）
        2）字段：
            2.1）Id:int auto pk
            2.2）File_name:varchar(100)
            2.3）File_path:varchar(100)
            2.4）File_type:int(10)
            2.5）File_size:int(10)
            2.6）File_status:int(10)
            2.7）Create_time:datetime
            2.8）Update_time:datetime
            2.9）APPID:varchar(100) fk
   （3）文件操作历史记录File_history
        1）数据引擎：MyISAM（增量表）
        2）字段：
            2.1）Id:int auto pk
            2.2）File_name:varchar(100)
            2.3）File_path:varchar(100)
            2.4）File_type:int(10)
            2.5）File_size:int(10)
            2.6）History_status:int(10)
            2.7）Create_time:datetime
            2.8）Update_time:datetime
            2.9）APPID:varchar(100) fk
   （4）用户容量表User_volume
        1）数据引擎：MyISAM（一条数据）
        2）字段：
            2.1）Id:int auto pk
            2.2）Size:int
            2.3) Def_size:int
            2.4) Max_size:int
            2.5) Expire_time:datetime
            2.6) APPID:varchar(100) fk
#### 5.中间件（要知道，然后知道怎么用，用在哪，有什么优势劣势）
   （1）文件系统：HDFS 
   （2）缓存：Zookeeper（十几万的并发redis基本撑不住了，所以大项目用Zookeeper(和Kafka)，
          不存在性能瓶颈，也就是上限）
   （3）消息系统（刷容量）：Kafka
    
                     
                                 
                   